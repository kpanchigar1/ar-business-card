<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="index.css">
    <meta charset="UTF-8">
    <meta name="description" content="John McNamara's AR Business Card">

    <!-- initialising the viewport -->
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <!-- load a-frame and ar.js-->
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>

    <!-- This is a hack because at the time of writing there are some distortions in the provided visuals until the  -->
    <!-- system receives a resize event. The resize event must be triggered when everything has been loaded and the  -->
    <!-- camera has been initialized. All the events I tried didn't work, so in the end I resorted using a 3 seconds -->
    <!-- time-out after the load event. When this problem will be fixed in the AR.js library, this hack won't be necessary -->
    <!-- anymore -->
    <!-- do we need this?? -->
    <script>
    window.onload = function(){
        setTimeout(function(){
            var resizeEvent = window.document.createEvent('UIEvents');
            resizeEvent.initUIEvent('resize', true, false, window, 0);
            window.dispatchEvent(resizeEvent);
        }, 3000);
    };
    </script>
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</head>

<body style='margin : 0px; overflow: hidden;'>
    <!-- define the scene  -->
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
        <!-- defining the content to appear (avatar of john) -->
        <a-assets>
            <a-asset-item id="john" src="/models/john_in_suit.glb"></a-asset-item>
            <img crossorigin="anonymous" id="emailTexture" src="https://cdn.glitch.com/6f8b5a13-fd4d-445d-b9eb-57c735d720ea%2FPostEmail.png?1528821333360">
            <img crossorigin="anonymous" id="linkedinTexture" src="https://cdn.glitch.com/6f8b5a13-fd4d-445d-b9eb-57c735d720ea%2FPostLinkedin.png?1528821333139">
        </a-assets>

        <!-- defining the marker to scan using a .patt file -->
        <a-marker camera="active:false" preset='custom' type='pattern'
                  url='https://startling-hummingbird-a198e7.netlify.app/marker/pattern-12.patt'>

        <a-entity position="-2 .5 -1.4" rotation="-45.98 -4.56 5.28" scale="0.1 .25 .2" text-geometry="bevelEnabled:true;bevelSize:0.1;bevelThickness:0.1;curveSegments:1;font:https://cdn.glitch.com/c719c986-c0c5-48b8-967c-3cd8b8aa17f3%2Fexo2Black.typeface.json?1490305922150;height:0.5;size:2;value:J O H N   M C N A M A R A" material="color:pink;metalness:0.9;roughness:0.05;sphericalEnvMap:https://cdn.glitch.com/6f8b5a13-fd4d-445d-b9eb-57c735d720ea%2FTextureMap.png?1528781398531"></a-entity>

        <!-- linking the marker to the model we want to show -->
        <a-entity gltf-model="#john" scale="1 1 1" position="0 0 0"></a-entity>

        <!-- Adding some test links -- can be replaced with speech bubbles -->
        <a-link class="clickable" href="https://www.linkedin.com/in/jonmcnamara/" title="" image="" position="-1.4 0.0 0.333"  rotation="-67.42 0 0" scale="0.6 0.6 0.6" geometry="primitive:circle;segments:64" material="shader:portal;side:double;visible:false" link="title:."><a-box scale="0.8 0.8 1.05" material="src:#linkedinTexture" position="-0.09854454977856898 -0.0036935886841299587 -0.2155814669584256" radius="2" segments-height="84" rotation="-23.450000000000003 0 0" geometry="">
        </a-box></a-link>

        <a-link class="clickable" href="mailto:j0nnymac@uk.ibm.com" title="" image="" position="-.7 0 1" rotation="-67.42 0 0" scale="0.6 0.6 0.6" geometry="primitive:circle;segments:64" material="shader:portal;side:double;visible:false" link="title:."><a-box scale="0.8 0.8 1.05" material="src:#emailTexture" position="-0.09854454977856898 -0.0036935886841299587 -0.2155814669584256" radius="2" segments-height="84" rotation="-23.450000000000003 0 0" geometry="">
        </a-box></a-link>
        </a-marker>

        <a-entity camera="" position="" rotation="" scale="" visible=""></a-entity>
        <a-entity cursor="fuse: true; fuseTimeout: 500"
                  position="0 0 -1"
                  geometry="primitive: ring"
                  material="color: green; shader: flat">
        </a-entity>
        </a-entity>
        </a-scene>

            <script>
                /**
                    Note to coder,
                    Event listeners are being added to the bubbles, however, due
                    to the nature of the element, the bubbles are unclickable.
                 */

                // var gotitBtn = $(".gotit");
                // gotitBtn.click(function() {
                //     gotitBtn.parent().css({
                //         display: "none"
                //     });
                // });
                //Camera feature check
                // function hasGetUserMedia() {
                //     return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
                //         navigator.mozGetUserMedia || navigator.msGetUserMedia);
                // }
                //
                // if (hasGetUserMedia()) {
                //     $('#splashScreen').css('display', 'block');
                // } else {
                //     // TODO: add a message to the user that the camera is not supported
                // }

                // document.addEventListener('DOMContentLoaded', function() {
                //     console.log("Added event listeners to the bubbles");
                //
                //     // Add click event listeners to the buttons
                //     document.getElementById("speechBubble1").addEventListener("touchstart", e => {
                //         e.preventDefault();
                //
                //         // For debugging purposes
                //         console.log("Clicked on speech bubble 1");
                //     });
                //     document.getElementById("speechBubble2").addEventListener("touchstart", e => {
                //         e.preventDefault();
                //
                //         // For debugging purposes
                //         console.log("Clicked on speech bubble 2");
                //     });
                //     document.getElementById("speechBubble3").addEventListener("touchstart", e => {
                //         e.preventDefault();
                //
                //         // For debugging purposes
                //         console.log("Clicked on speech bubble 3");
                //     });
                //     document.getElementById("peter").addEventListener("touchstart", e => {
                //         // For debugging purposes
                //         console.log("PETAH");
                //     });
                // });

                let audioPlayedCounter = false;

                document.querySelector('a-marker').addEventListener('markerFound', function() {
                    // Checks if overview audio played already
                    if (!audioPlayedCounter) {
                        console.log("Playing overview audio");
                        let audio = new Audio('https://startling-hummingbird-a198e7.netlify.app/js/overview.wav');
                        audio.play();
                    }
                    audioPlayedCounter = true;
                })
            </script>
        </a-marker>
        <a-entity camera></a-entity>
</body>
</html>
